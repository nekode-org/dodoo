import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.BJfUAbRs.js";import{s as o}from"./index.95d291e9.F47FPULG.js";const P=({folio:t,onInputChange:n})=>e.jsxs("div",{className:o.Elemento,children:[e.jsx("input",{type:"text",name:"ticketCode",placeholder:"Folio de ticket",className:o.Folio,value:t.ticketCode,onChange:i=>n(t.id,"ticketCode",i.target.value)}),e.jsxs("select",{name:"providerCode",className:o.Empresa,value:t.providerCode||"",onChange:i=>n(t.id,"providerCode",parseInt(i.target.value,10)),children:[e.jsx("option",{value:"",disabled:!0,children:"Selecciona una empresa"}),e.jsx("option",{value:"1",children:"Empresa 1"}),e.jsx("option",{value:"2",children:"Empresa 2"}),e.jsx("option",{value:"3",children:"Empresa 3"})]})]}),S=()=>{const[t,n]=l.useState({email:"",rfc:"",rfcPdf:null,rfcPdfName:null,tickets:[{id:Date.now(),ticketCode:"",providerCode:null}]}),[i,v]=l.useState([]);l.useEffect(()=>{(async()=>{try{const a=await fetch("/providers/getList");if(!a.ok)throw new Error("Error al obtener la lista de proveedores");const s=await a.json();v(s)}catch(a){console.error("Error al obtener los proveedores:",a)}})()},[]);const[f,c]=l.useState(!1),[y,d]=l.useState(0),g=()=>{n({...t,tickets:[...t.tickets,{id:Date.now(),ticketCode:"",providerCode:null}]})},x=r=>{n({...t,tickets:t.tickets.filter(a=>a.id!==r)})},u=(r,a,s)=>{n({...t,tickets:t.tickets.map(p=>p.id===r?{...p,[a]:s}:p)})},m=r=>{const{name:a,value:s}=r.target;n({...t,[a]:s})},h=r=>{if(r){const a=new FileReader;a.onload=()=>{n({...t,rfcPdf:a.result.split(",")[1],rfcPdfName:r.name})},a.readAsDataURL(r)}else n({...t,rfcPdf:null,rfcPdfName:null})},j=r=>{r.preventDefault(),r.stopPropagation(),c(!1),d(0);const a=r.dataTransfer.files[0];a&&a.type==="application/pdf"?h(a):alert("Por favor, arrastra un archivo PDF vÃ¡lido.")},C=r=>{r.preventDefault(),r.stopPropagation()},D=r=>{r.preventDefault(),r.stopPropagation(),d(a=>a+1),c(!0)},k=r=>{r.preventDefault(),r.stopPropagation(),d(a=>{const s=a-1;return s===0&&c(!1),s})},N=async()=>{const r={...t,tickets:t.tickets.map(({id:a,...s})=>s)};console.log("Datos del formulario:",JSON.stringify(r));try{const a=await fetch("/providers/getInfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok)throw new Error("Error en la respuesta del servidor");const s=await a.json();console.log("Respuesta del servidor:",s),document.cookie=await`data=${encodeURIComponent(JSON.stringify(s))}; path=/; max-age=3600`,window.location.href="/Datos"}catch(a){console.error("Error al enviar el formulario:",a),alert("Error al enviar el formulario. Por favor, intÃ©ntalo de nuevo.")}};return e.jsxs("div",{className:o.fullScreenDropZone,onDrop:j,onDragOver:C,onDragEnter:D,onDragLeave:k,children:[f&&e.jsx("div",{className:o.dragOverlay,children:e.jsx("p",{children:"Suelta el archivo aquÃ­"})}),e.jsxs("div",{className:o.principal,children:[e.jsxs("label",{className:o.email,children:["Ingresa tu correo electrÃ³nico:",e.jsx("input",{type:"email",name:"email",value:t.email,onChange:m})]}),e.jsxs("div",{className:o.rfcContainer,children:[e.jsxs("div",{className:o.rfcPDF,children:[e.jsxs("label",{children:["Carga tu informaciÃ³n fÃ­scal en PDF.",e.jsx("p",{style:{color:"gray"},children:"Arrastra y suelta el archivo aquÃ­ o selecciona uno"}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:r=>h(r.target.files[0])})]}),t.rfcPdfName&&e.jsxs("p",{style:{color:"green"},children:["Archivo cargado: ",t.rfcPdfName]})]}),e.jsx("p",{children:"O"}),e.jsxs("label",{className:o.rfcText,children:["Ingresar tu RFC:",e.jsx("input",{type:"text",name:"rfc",value:t.rfc,onChange:m})]})]}),e.jsxs("div",{className:o.foliosContainer,children:[e.jsxs("div",{className:o.Titulos,children:[e.jsx("h3",{children:"Ingresa el nÃºmero de ticket"}),e.jsx("h3",{className:o.Titulito,children:"Selecciona la empresa correspondiente al ticket"})]}),t.tickets.map(r=>e.jsxs("div",{className:o.folioitem,children:[e.jsx(P,{folio:r,onInputChange:u}),e.jsxs("select",{name:"providerCode",value:r.providerCode||"",onChange:a=>u(r.id,"providerCode",a.target.value),children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),i.map(a=>e.jsx("option",{value:a.numero,children:a.string},a.numero))]}),e.jsx("button",{onClick:()=>x(r.id),className:o.Basura,children:"ðŸ—‘"})]},r.id))]}),e.jsxs("div",{className:o.botonera,children:[e.jsx("button",{onClick:g,children:"Agregar Folio"}),e.jsx("button",{onClick:N,children:"Enviar Formulario"})]})]})]})};export{S as default};
