import{j as r}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.BJfUAbRs.js";import{s as o}from"./index.95d291e9.F47FPULG.js";const P=({folio:t,onInputChange:n})=>r.jsxs("div",{className:o.Elemento,children:[r.jsx("input",{type:"text",name:"ticketCode",placeholder:"Folio de ticket",className:o.Folio,value:t.ticketCode,onChange:l=>n(t.id,"ticketCode",l.target.value)}),r.jsxs("select",{name:"providerCode",className:o.Empresa,value:t.providerCode||"",onChange:l=>n(t.id,"providerCode",parseInt(l.target.value,10)),children:[r.jsx("option",{value:"",disabled:!0,children:"Selecciona una empresa"}),r.jsx("option",{value:"1",children:"Empresa 1"}),r.jsx("option",{value:"2",children:"Empresa 2"}),r.jsx("option",{value:"3",children:"Empresa 3"})]})]}),S=()=>{const[t,n]=i.useState({email:"",rfc:"",rfcPdf:null,rfcPdfName:null,tickets:[{id:Date.now(),ticketCode:"",providerCode:null}]}),[l,h]=i.useState([]);i.useEffect(()=>{(async()=>{try{const a=await fetch("/providers/getList");if(!a.ok)throw new Error("Error al obtener la lista de proveedores");const s=await a.json();h(s)}catch(a){console.error("Error al obtener los proveedores:",a)}})()},[]);const[f,c]=i.useState(!1),[y,d]=i.useState(0),v=()=>{n({...t,tickets:[...t.tickets,{id:Date.now(),ticketCode:"",providerCode:null}]})},g=e=>{n({...t,tickets:t.tickets.filter(a=>a.id!==e)})},x=(e,a,s)=>{n({...t,tickets:t.tickets.map(p=>p.id===e?{...p,[a]:s}:p)})},u=e=>{const{name:a,value:s}=e.target;n({...t,[a]:s})},m=e=>{if(e){const a=new FileReader;a.onload=()=>{n({...t,rfcPdf:a.result.split(",")[1],rfcPdfName:e.name})},a.readAsDataURL(e)}else n({...t,rfcPdf:null,rfcPdfName:null})},j=e=>{e.preventDefault(),e.stopPropagation(),c(!1),d(0);const a=e.dataTransfer.files[0];a&&a.type==="application/pdf"?m(a):alert("Por favor, arrastra un archivo PDF vÃ¡lido.")},C=e=>{e.preventDefault(),e.stopPropagation()},D=e=>{e.preventDefault(),e.stopPropagation(),d(a=>a+1),c(!0)},k=e=>{e.preventDefault(),e.stopPropagation(),d(a=>{const s=a-1;return s===0&&c(!1),s})},N=async()=>{const e={...t,tickets:t.tickets.map(({id:a,...s})=>s)};console.log("Datos del formulario:",JSON.stringify(e));try{const a=await fetch("/providers/getInfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw new Error("Error en la respuesta del servidor");const s=await a.json();console.log("Respuesta del servidor:",s),document.cookie=await`data=${encodeURIComponent(JSON.stringify(s))}; path=/; max-age=3600`,window.location.href="/Datos/index.html"}catch(a){console.error("Error al enviar el formulario:",a),alert("Error al enviar el formulario. Por favor, intÃ©ntalo de nuevo.")}};return r.jsxs("div",{className:o.fullScreenDropZone,onDrop:j,onDragOver:C,onDragEnter:D,onDragLeave:k,children:[f&&r.jsx("div",{className:o.dragOverlay,children:r.jsx("p",{children:"Suelta el archivo aquÃ­"})}),r.jsxs("div",{className:o.principal,children:[r.jsxs("label",{className:o.email,children:["Ingresa tu correo electrÃ³nico:",r.jsx("input",{type:"email",name:"email",value:t.email,onChange:u})]}),r.jsxs("div",{className:o.rfcContainer,children:[r.jsxs("div",{className:o.rfcPDF,children:[r.jsxs("label",{children:["Carga tu informaciÃ³n fÃ­scal en PDF.",r.jsx("p",{style:{color:"gray"},children:"Arrastra y suelta el archivo aquÃ­ o selecciona uno"}),r.jsx("input",{type:"file",accept:"application/pdf",onChange:e=>m(e.target.files[0])})]}),t.rfcPdfName&&r.jsxs("p",{style:{color:"green"},children:["Archivo cargado: ",t.rfcPdfName]})]}),r.jsx("p",{children:"O"}),r.jsxs("label",{className:o.rfcText,children:["Ingresar tu RFC:",r.jsx("input",{type:"text",name:"rfc",value:t.rfc,onChange:u})]})]}),r.jsxs("div",{className:o.foliosContainer,children:[r.jsxs("div",{className:o.Titulos,children:[r.jsx("h3",{children:"Ingresa el nÃºmero de ticket"}),r.jsx("h3",{className:o.Titulito,children:"Selecciona la empresa correspondiente al ticket"})]}),t.tickets.map(e=>r.jsxs("div",{className:o.folioitem,children:[r.jsx(P,{folio:e,onInputChange:x}),r.jsx("button",{onClick:()=>g(e.id),className:o.Basura,children:"ðŸ—‘"})]},e.id))]}),r.jsxs("div",{className:o.botonera,children:[r.jsx("button",{onClick:v,children:"Agregar Folio"}),r.jsx("button",{onClick:N,children:"Enviar Formulario"})]})]})]})};export{S as default};
